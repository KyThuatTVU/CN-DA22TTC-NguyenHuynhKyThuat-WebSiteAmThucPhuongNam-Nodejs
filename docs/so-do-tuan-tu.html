<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sơ đồ Tuần tự - Website Nhà Hàng Phương Nam</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; background: #fff; }
        h1, h2 { text-align: center; margin-bottom: 20px; }
        svg { display: block; margin: 0 auto 40px; }
        .page-break { page-break-before: always; }
    </style>
</head>
<body>
    <h1>SƠ ĐỒ TUẦN TỰ (SEQUENCE DIAGRAM)</h1>
    <h2>Website Nhà Hàng Ẩm Thực Phương Nam - Vĩnh Long</h2>

    <!-- Sơ đồ 1: Đăng ký tài khoản -->
    <h2>1. Quy trình Đăng ký tài khoản</h2>
    <svg width="900" height="650" style="border: 1px solid #000;">
        <!-- Actors/Objects -->
        <rect x="50" y="20" width="80" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="65" y="45" font-size="11" font-weight="bold">User</text>
        
        <rect x="230" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="245" y="45" font-size="11" font-weight="bold">Frontend</text>
        
        <rect x="430" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="450" y="45" font-size="11" font-weight="bold">Backend</text>
        
        <rect x="630" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="650" y="45" font-size="11" font-weight="bold">Database</text>
        
        <rect x="800" y="20" width="80" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="815" y="45" font-size="11" font-weight="bold">Email</text>
        
        <!-- Lifelines -->
        <line x1="90" y1="60" x2="90" y2="620" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="280" y1="60" x2="280" y2="620" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="480" y1="60" x2="480" y2="620" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="680" y1="60" x2="680" y2="620" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="840" y1="60" x2="840" y2="620" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        
        <!-- Messages -->
        <!-- 1. Nhập thông tin -->
        <line x1="90" y1="90" x2="280" y2="90" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="120" y="85" font-size="9">1. Nhập thông tin đăng ký</text>
        
        <!-- 2. POST send-verification -->
        <line x1="280" y1="120" x2="480" y2="120" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="290" y="115" font-size="9">2. POST /api/auth/send-verification</text>
        
        <!-- 3. Kiểm tra email -->
        <line x1="480" y1="150" x2="680" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="520" y="145" font-size="9">3. SELECT email</text>
        
        <!-- 4. Return -->
        <line x1="680" y1="170" x2="480" y2="170" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="540" y="165" font-size="9">4. Result</text>
        
        <!-- 5. Hash password -->
        <rect x="460" y="190" width="40" height="30" fill="none" stroke="#000" stroke-width="1"/>
        <text x="390" y="210" font-size="9">5. bcrypt.hash()</text>
        
        <!-- 6. Lưu mã xác thực -->
        <line x1="480" y1="240" x2="680" y2="240" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="490" y="235" font-size="9">6. INSERT xac_thuc_email</text>
        
        <!-- 7. Return -->
        <line x1="680" y1="260" x2="480" y2="260" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        
        <!-- 8. Gửi email -->
        <line x1="480" y1="290" x2="840" y2="290" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="580" y="285" font-size="9">8. sendVerificationEmail()</text>
        
        <!-- 9. Email sent -->
        <line x1="840" y1="310" x2="480" y2="310" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="620" y="305" font-size="9">9. Success</text>
        
        <!-- 10. Response -->
        <line x1="480" y1="340" x2="280" y2="340" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="320" y="335" font-size="9">10. {success: true}</text>
        
        <!-- 11. Hiển thị form OTP -->
        <line x1="280" y1="370" x2="90" y2="370" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="120" y="365" font-size="9">11. Hiển thị form nhập OTP</text>
        
        <!-- 12. Nhập OTP -->
        <line x1="90" y1="400" x2="280" y2="400" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="140" y="395" font-size="9">12. Nhập mã OTP</text>
        
        <!-- 13. POST verify-email -->
        <line x1="280" y1="430" x2="480" y2="430" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="300" y="425" font-size="9">13. POST /api/auth/verify-email</text>
        
        <!-- 14. Kiểm tra mã -->
        <line x1="480" y1="460" x2="680" y2="460" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="455" font-size="9">14. SELECT xac_thuc_email</text>
        
        <!-- 15. Return -->
        <line x1="680" y1="480" x2="480" y2="480" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        
        <!-- 16. Tạo user -->
        <line x1="480" y1="510" x2="680" y2="510" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="505" font-size="9">16. INSERT nguoi_dung</text>
        
        <!-- 17. Return -->
        <line x1="680" y1="530" x2="480" y2="530" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        
        <!-- 18. Tạo JWT -->
        <rect x="460" y="545" width="40" height="25" fill="none" stroke="#000" stroke-width="1"/>
        <text x="390" y="560" font-size="9">18. jwt.sign()</text>
        
        <!-- 19. Response -->
        <line x1="480" y1="585" x2="280" y2="585" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="310" y="580" font-size="9">19. {token, user}</text>
        
        <!-- 20. Chuyển trang -->
        <line x1="280" y1="610" x2="90" y2="610" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="120" y="605" font-size="9">20. Đăng ký thành công</text>
        
        <!-- Arrow marker -->
        <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <path d="M0,0 L0,6 L9,3 z" fill="#000"/>
            </marker>
        </defs>
    </svg>

    <div class="page-break"></div>
    
    <!-- Sơ đồ 2: Đặt hàng -->
    <h2>2. Quy trình Đặt hàng và Thanh toán</h2>
    <svg width="900" height="700" style="border: 1px solid #000;">
        <!-- Actors/Objects -->
        <rect x="50" y="20" width="80" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="65" y="45" font-size="11" font-weight="bold">User</text>
        
        <rect x="230" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="245" y="45" font-size="11" font-weight="bold">Frontend</text>
        
        <rect x="430" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="450" y="45" font-size="11" font-weight="bold">Backend</text>
        
        <rect x="630" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="650" y="45" font-size="11" font-weight="bold">Database</text>
        
        <rect x="800" y="20" width="80" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="815" y="45" font-size="11" font-weight="bold">MoMo</text>
        
        <!-- Lifelines -->
        <line x1="90" y1="60" x2="90" y2="680" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="280" y1="60" x2="280" y2="680" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="480" y1="60" x2="480" y2="680" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="680" y1="60" x2="680" y2="680" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="840" y1="60" x2="840" y2="680" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        
        <!-- Messages -->
        <!-- 1. Vào trang thanh toán -->
        <line x1="90" y1="90" x2="280" y2="90" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="110" y="85" font-size="9">1. Vào trang thanh toán</text>
        
        <!-- 2. GET cart -->
        <line x1="280" y1="115" x2="480" y2="115" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="330" y="110" font-size="9">2. GET /api/cart</text>
        
        <!-- 3. Query -->
        <line x1="480" y1="140" x2="680" y2="140" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="530" y="135" font-size="9">3. SELECT giỏ hàng</text>
        
        <!-- 4. Return -->
        <line x1="680" y1="160" x2="480" y2="160" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        
        <!-- 5. Return cart -->
        <line x1="480" y1="180" x2="280" y2="180" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="330" y="175" font-size="9">5. {cart items}</text>
        
        <!-- 6. Hiển thị -->
        <line x1="280" y1="200" x2="90" y2="200" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="120" y="195" font-size="9">6. Hiển thị giỏ hàng</text>
        
        <!-- 7. Nhập thông tin -->
        <line x1="90" y1="230" x2="280" y2="230" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="100" y="225" font-size="9">7. Nhập thông tin giao hàng</text>
        
        <!-- 8. Chọn MoMo -->
        <line x1="90" y1="260" x2="280" y2="260" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="110" y="255" font-size="9">8. Chọn thanh toán MoMo</text>
        
        <!-- 9. POST create order -->
        <line x1="280" y1="290" x2="480" y2="290" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="290" y="285" font-size="9">9. POST /api/orders/create</text>
        
        <!-- 10. BEGIN TRANSACTION -->
        <rect x="460" y="305" width="40" height="20" fill="none" stroke="#000" stroke-width="1"/>
        <text x="380" y="320" font-size="9">10. BEGIN TRANS</text>
        
        <!-- 11. Kiểm tra tồn kho -->
        <line x1="480" y1="340" x2="680" y2="340" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="335" font-size="9">11. Kiểm tra tồn kho</text>
        
        <!-- 12. Return -->
        <line x1="680" y1="360" x2="480" y2="360" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        
        <!-- 13. INSERT don_hang -->
        <line x1="480" y1="385" x2="680" y2="385" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="380" font-size="9">13. INSERT don_hang</text>
        
        <!-- 14. INSERT chi_tiet -->
        <line x1="480" y1="410" x2="680" y2="410" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="500" y="405" font-size="9">14. INSERT chi_tiet_don_hang</text>
        
        <!-- 15. UPDATE tồn kho -->
        <line x1="480" y1="435" x2="680" y2="435" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="430" font-size="9">15. UPDATE tồn kho</text>
        
        <!-- 16. COMMIT -->
        <rect x="460" y="450" width="40" height="20" fill="none" stroke="#000" stroke-width="1"/>
        <text x="410" y="465" font-size="9">16. COMMIT</text>
        
        <!-- 17. Return order -->
        <line x1="480" y1="485" x2="280" y2="485" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="310" y="480" font-size="9">17. {ma_don_hang}</text>
        
        <!-- 18. POST MoMo -->
        <line x1="280" y1="510" x2="480" y2="510" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="290" y="505" font-size="9">18. POST /api/payment/momo</text>
        
        <!-- 19. Call MoMo API -->
        <line x1="480" y1="535" x2="840" y2="535" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="580" y="530" font-size="9">19. Create payment request</text>
        
        <!-- 20. Return payUrl -->
        <line x1="840" y1="555" x2="480" y2="555" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="600" y="550" font-size="9">20. {payUrl}</text>
        
        <!-- 21. Return -->
        <line x1="480" y1="575" x2="280" y2="575" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="330" y="570" font-size="9">21. {payUrl}</text>
        
        <!-- 22. Redirect -->
        <line x1="280" y1="600" x2="90" y2="600" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="120" y="595" font-size="9">22. Redirect to MoMo</text>
        
        <!-- 23. Thanh toán -->
        <line x1="90" y1="625" x2="840" y2="625" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="400" y="620" font-size="9">23. Thanh toán trên MoMo</text>
        
        <!-- 24. Callback -->
        <line x1="840" y1="650" x2="480" y2="650" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="580" y="645" font-size="9">24. IPN Callback</text>
        
        <!-- 25. Update -->
        <line x1="480" y1="670" x2="680" y2="670" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="500" y="665" font-size="9">25. UPDATE thanh_toan</text>
        
        <!-- Arrow marker -->
        <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <path d="M0,0 L0,6 L9,3 z" fill="#000"/>
            </marker>
        </defs>
    </svg>

    <div class="page-break"></div>
    
    <!-- Sơ đồ 3: Đăng nhập -->
    <h2>3. Quy trình Đăng nhập</h2>
    <svg width="800" height="400" style="border: 1px solid #000;">
        <!-- Actors/Objects -->
        <rect x="50" y="20" width="80" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="65" y="45" font-size="11" font-weight="bold">User</text>
        
        <rect x="230" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="245" y="45" font-size="11" font-weight="bold">Frontend</text>
        
        <rect x="430" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="450" y="45" font-size="11" font-weight="bold">Backend</text>
        
        <rect x="630" y="20" width="100" height="40" fill="none" stroke="#000" stroke-width="2"/>
        <text x="650" y="45" font-size="11" font-weight="bold">Database</text>
        
        <!-- Lifelines -->
        <line x1="90" y1="60" x2="90" y2="380" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="280" y1="60" x2="280" y2="380" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="480" y1="60" x2="480" y2="380" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        <line x1="680" y1="60" x2="680" y2="380" stroke="#000" stroke-width="1" stroke-dasharray="5,5"/>
        
        <!-- Messages -->
        <line x1="90" y1="90" x2="280" y2="90" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="110" y="85" font-size="9">1. Nhập email, mật khẩu</text>
        
        <line x1="280" y1="120" x2="480" y2="120" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="310" y="115" font-size="9">2. POST /api/auth/login</text>
        
        <line x1="480" y1="150" x2="680" y2="150" stroke="#000" stroke-width="1" marker-end="url(#arrow)"/>
        <text x="510" y="145" font-size="9">3. SELECT nguoi_dung WHERE email</text>
        
        <line x1="680" y1="180" x2="480" y2="180" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="540" y="175" font-size="9">4. User data</text>
        
        <rect x="460" y="200" width="40" height="30" fill="none" stroke="#000" stroke-width="1"/>
        <text x="370" y="220" font-size="9">5. bcrypt.compare()</text>
        
        <rect x="460" y="250" width="40" height="30" fill="none" stroke="#000" stroke-width="1"/>
        <text x="390" y="270" font-size="9">6. jwt.sign()</text>
        
        <line x1="480" y1="300" x2="280" y2="300" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="310" y="295" font-size="9">7. {success, token, user}</text>
        
        <rect x="260" y="315" width="40" height="25" fill="none" stroke="#000" stroke-width="1"/>
        <text x="170" y="330" font-size="9">8. localStorage.setItem()</text>
        
        <line x1="280" y1="360" x2="90" y2="360" stroke="#000" stroke-width="1" stroke-dasharray="3,3" marker-end="url(#arrow)"/>
        <text x="110" y="355" font-size="9">9. Chuyển đến trang chủ</text>
        
        <defs>
            <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                <path d="M0,0 L0,6 L9,3 z" fill="#000"/>
            </marker>
        </defs>
    </svg>
</body>
</html>
