<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VNPay Mock Payment - Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
            <div class="text-center mb-6">
                <div class="w-20 h-20 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">VNPay Mock Payment</h1>
                <p class="text-gray-600 mt-2">Trang giả lập thanh toán VNPay cho mục đích demo</p>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <h2 class="font-semibold text-blue-800 mb-2">Thông tin giao dịch</h2>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Mã đơn hàng:</span>
                        <span class="font-semibold" id="orderId">...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Số tiền:</span>
                        <span class="font-semibold text-red-600" id="amount">...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Mã giao dịch:</span>
                        <span class="font-mono text-xs" id="txnRef">...</span>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <button onclick="simulateSuccess()" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                    ✓ Thanh toán thành công
                </button>
                <button onclick="simulateFail()" class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                    ✗ Thanh toán thất bại
                </button>
                <button onclick="simulateCancel()" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 rounded-lg transition duration-200">
                    ← Hủy giao dịch
                </button>
            </div>

            <div class="mt-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <p class="text-xs text-yellow-800">
                    <strong>Lưu ý:</strong> Đây là trang giả lập để demo. 
                    VNPay sandbox hiện đang có lỗi JavaScript nên không thể test thực tế. 
                    Trong production, bạn cần liên hệ VNPay để được cấp tài khoản chính thức.
                </p>
            </div>
        </div>
    </div>

    <script>
        // Lấy params từ URL
        const urlParams = new URLSearchParams(window.location.search);
        
        // Parse các params VNPay
        const params = {
            vnp_TxnRef: urlParams.get('vnp_TxnRef') || 'N/A',
            vnp_Amount: urlParams.get('vnp_Amount') || '0',
            vnp_OrderInfo: urlParams.get('vnp_OrderInfo') || 'N/A',
            vnp_ReturnUrl: urlParams.get('vnp_ReturnUrl') || ''
        };

        // Hiển thị thông tin
        document.getElementById('orderId').textContent = params.vnp_TxnRef.split('_')[0] || 'N/A';
        document.getElementById('amount').textContent = new Intl.NumberFormat('vi-VN', { 
            style: 'currency', 
            currency: 'VND' 
        }).format(params.vnp_Amount / 100);
        document.getElementById('txnRef').textContent = params.vnp_TxnRef;

        function simulateSuccess() {
            const returnUrl = params.vnp_ReturnUrl;
            if (!returnUrl) {
                alert('Không có Return URL!');
                return;
            }

            // Tạo params callback giả lập
            const callbackParams = new URLSearchParams({
                vnp_Amount: params.vnp_Amount,
                vnp_BankCode: 'NCB',
                vnp_BankTranNo: 'VNP' + Date.now(),
                vnp_CardType: 'ATM',
                vnp_OrderInfo: params.vnp_OrderInfo,
                vnp_PayDate: new Date().toISOString().replace(/[-:T.]/g, '').slice(0, 14),
                vnp_ResponseCode: '00', // Success
                vnp_TmnCode: urlParams.get('vnp_TmnCode') || 'DEMOV210',
                vnp_TransactionNo: Date.now().toString(),
                vnp_TransactionStatus: '00',
                vnp_TxnRef: params.vnp_TxnRef,
                vnp_SecureHash: 'mock_hash_' + Date.now()
            });

            window.location.href = returnUrl + '?' + callbackParams.toString();
        }

        function simulateFail() {
            const returnUrl = params.vnp_ReturnUrl;
            if (!returnUrl) {
                alert('Không có Return URL!');
                return;
            }

            const callbackParams = new URLSearchParams({
                vnp_Amount: params.vnp_Amount,
                vnp_OrderInfo: params.vnp_OrderInfo,
                vnp_ResponseCode: '24', // Failed
                vnp_TmnCode: urlParams.get('vnp_TmnCode') || 'DEMOV210',
                vnp_TxnRef: params.vnp_TxnRef,
                vnp_SecureHash: 'mock_hash_' + Date.now()
            });

            window.location.href = returnUrl + '?' + callbackParams.toString();
        }

        function simulateCancel() {
            const returnUrl = params.vnp_ReturnUrl;
            if (!returnUrl) {
                alert('Không có Return URL!');
                return;
            }

            const callbackParams = new URLSearchParams({
                vnp_Amount: params.vnp_Amount,
                vnp_OrderInfo: params.vnp_OrderInfo,
                vnp_ResponseCode: '24', // Cancelled
                vnp_TmnCode: urlParams.get('vnp_TmnCode') || 'DEMOV210',
                vnp_TxnRef: params.vnp_TxnRef,
                vnp_SecureHash: 'mock_hash_' + Date.now()
            });

            window.location.href = returnUrl + '?' + callbackParams.toString();
        }
    </script>
</body>
</html>
