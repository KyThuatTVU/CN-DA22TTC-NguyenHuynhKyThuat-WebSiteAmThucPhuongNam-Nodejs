<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test My Orders API</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Test My Orders API</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">API Test</h2>
            <button onclick="testAPI()" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                Test API
            </button>
        </div>
        
        <div id="results" class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">Results</h2>
            <pre id="output" class="bg-gray-100 p-4 rounded overflow-auto text-sm"></pre>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';
        
        function getToken() {
            return localStorage.getItem('token') || sessionStorage.getItem('token');
        }
        
        async function testAPI() {
            const output = document.getElementById('output');
            output.textContent = 'Testing...\n\n';
            
            try {
                const token = getToken();
                
                output.textContent += `Token: ${token ? token.substring(0, 50) + '...' : 'NOT FOUND'}\n\n`;
                
                if (!token) {
                    output.textContent += '❌ No token found! Please login first.\n';
                    return;
                }
                
                const url = `${API_URL}/orders/my-orders`;
                output.textContent += `URL: ${url}\n\n`;
                
                output.textContent += 'Fetching...\n';
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                output.textContent += `Status: ${response.status} ${response.statusText}\n\n`;
                
                const result = await response.json();
                
                output.textContent += 'Response:\n';
                output.textContent += JSON.stringify(result, null, 2);
                
                if (result.success) {
                    output.textContent += `\n\n✅ Success! Found ${result.data?.length || 0} orders`;
                } else {
                    output.textContent += `\n\n❌ Error: ${result.message}`;
                    if (result.error) {
                        output.textContent += `\nDetails: ${result.error}`;
                    }
                }
                
            } catch (error) {
                output.textContent += `\n\n❌ Exception: ${error.message}\n`;
                output.textContent += error.stack;
            }
        }
        
        // Auto test on load
        window.addEventListener('DOMContentLoaded', () => {
            const token = getToken();
            if (token) {
                document.getElementById('output').textContent = 'Token found. Click "Test API" button to test.\n\nOr wait 2 seconds for auto test...';
                setTimeout(testAPI, 2000);
            } else {
                document.getElementById('output').textContent = '❌ No token found!\n\nPlease login first at: dang-nhap.html';
            }
        });
    </script>
</body>
</html>
