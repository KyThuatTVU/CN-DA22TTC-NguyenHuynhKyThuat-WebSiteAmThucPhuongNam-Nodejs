<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt hàng thành công - Nhà hàng Phương Nam Vĩnh Long</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/modern-style.css">
</head>

<body class="bg-gradient-to-br from-orange-50 via-red-50 to-yellow-50">
    <!-- Navigation Container -->
    <div id="navbar-container"></div>

    <!-- Success Content -->
    <section class="py-20">
        <div class="container mx-auto px-4">
            <div class="max-w-2xl mx-auto">
                <!-- Success Card -->
                <div class="bg-white rounded-2xl shadow-xl p-8 text-center">
                    <!-- Success Icon -->
                    <div class="mb-6">
                        <div
                            class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto animate-bounce">
                            <i class="fas fa-check-circle text-5xl text-green-600"></i>
                        </div>
                    </div>

                    <!-- Success Message -->
                    <h1 class="text-3xl font-bold text-gray-800 mb-3">
                        Đặt hàng thành công!
                    </h1>
                    <p class="text-gray-600 mb-6">
                        Cảm ơn bạn đã đặt hàng tại Nhà hàng Phương Nam
                    </p>

                    <!-- Order Info -->
                    <div class="bg-orange-50 rounded-lg p-6 mb-8">
                        <div class="flex items-center justify-center mb-4">
                            <i class="fas fa-receipt text-2xl text-orange-600 mr-3"></i>
                            <div>
                                <p class="text-sm text-gray-600">Mã đơn hàng</p>
                                <p class="text-xl font-bold text-orange-600" id="order-code">Loading...</p>
                            </div>
                        </div>
                        <div class="border-t border-orange-200 pt-4">
                            <p class="text-sm text-gray-600 mb-2">
                                <i class="fas fa-info-circle mr-2"></i>
                                Chúng tôi đã gửi xác nhận đơn hàng qua email của bạn
                            </p>
                            <p class="text-sm text-gray-600">
                                <i class="fas fa-truck mr-2"></i>
                                Đơn hàng sẽ được giao trong vòng 30-45 phút
                            </p>
                        </div>
                    </div>

                    <!-- Order Details -->
                    <div class="bg-gray-50 rounded-lg p-6 mb-8 text-left" id="order-details">
                        <h3 class="font-bold text-lg mb-4 text-center">
                            <i class="fas fa-clipboard-list mr-2"></i>
                            Chi tiết đơn hàng
                        </h3>
                        <div id="order-items" class="space-y-3 mb-4">
                            <!-- Items will be loaded here -->
                        </div>
                        <div class="border-t pt-4">
                            <div class="flex justify-between text-gray-600 mb-2">
                                <span>Tạm tính</span>
                                <span id="subtotal">0đ</span>
                            </div>
                            <div class="flex justify-between text-gray-600 mb-2">
                                <span>Phí giao hàng</span>
                                <span id="shipping">0đ</span>
                            </div>
                            <div class="flex justify-between font-bold text-lg text-orange-600">
                                <span>Tổng cộng</span>
                                <span id="total">0đ</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <a href="index.html"
                            class="bg-orange-600 text-white py-3 rounded-lg font-medium hover:bg-orange-700 transition inline-block">
                            <i class="fas fa-home mr-2"></i>
                            Về trang chủ
                        </a>
                        <a href="thuc-don.html"
                            class="bg-white border-2 border-orange-600 text-orange-600 py-3 rounded-lg font-medium hover:bg-orange-50 transition inline-block">
                            <i class="fas fa-utensils mr-2"></i>
                            Đặt thêm món
                        </a>
                    </div>

                    <!-- Contact Info -->
                    <div class="mt-8 pt-6 border-t">
                        <p class="text-sm text-gray-600 mb-2">
                            <i class="fas fa-question-circle mr-2"></i>
                            Cần hỗ trợ? Liên hệ với chúng tôi
                        </p>
                        <div class="flex items-center justify-center space-x-6 text-sm">
                            <a href="tel:0123456789" class="text-orange-600 hover:underline">
                                <i class="fas fa-phone mr-1"></i>
                                0123 456 789
                            </a>
                            <a href="mailto:support@phuongnam.vn" class="text-orange-600 hover:underline">
                                <i class="fas fa-envelope mr-1"></i>
                                support@phuongnam.vn
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Timeline -->
                <div class="mt-8 bg-white rounded-xl p-6 shadow-sm">
                    <h3 class="font-bold text-lg mb-4 text-center">
                        <i class="fas fa-history mr-2"></i>
                        Quy trình giao hàng
                    </h3>
                    <div class="flex justify-between items-center">
                        <div class="flex-1 text-center">
                            <div
                                class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-check text-green-600"></i>
                            </div>
                            <p class="text-xs font-medium">Đã đặt hàng</p>
                        </div>
                        <div class="flex-1 border-t-2 border-dashed border-gray-300"></div>
                        <div class="flex-1 text-center">
                            <div
                                class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-fire text-orange-600"></i>
                            </div>
                            <p class="text-xs font-medium">Đang chuẩn bị</p>
                        </div>
                        <div class="flex-1 border-t-2 border-dashed border-gray-300"></div>
                        <div class="flex-1 text-center">
                            <div
                                class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-shipping-fast text-gray-400"></i>
                            </div>
                            <p class="text-xs font-medium">Đang giao</p>
                        </div>
                        <div class="flex-1 border-t-2 border-dashed border-gray-300"></div>
                        <div class="flex-1 text-center">
                            <div
                                class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2">
                                <i class="fas fa-star text-gray-400"></i>
                            </div>
                            <p class="text-xs font-medium">Hoàn thành</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script src="js/load-components.js"></script>

    <script>
        // API Configuration
        const API_URL = window.API_URL || 'http://localhost:3000/api';

        // Get token
        function getToken() {
            return localStorage.getItem('token') || sessionStorage.getItem('token');
        }

        // Format currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

        // Get order ID from URL
        function getOrderId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('order');
        }

        // Load order details
        async function loadOrderDetails() {
            const orderId = getOrderId();
            const orderCodeEl = document.getElementById('order-code');

            if (!orderId) {
                orderCodeEl.textContent = 'Không tìm thấy mã đơn hàng';
                return;
            }

            orderCodeEl.textContent = orderId;

            try {
                const token = getToken();
                const response = await fetch(`${API_URL}/orders/${orderId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        displayOrderDetails(result.data);
                    }
                }
            } catch (error) {
                console.error('Error loading order:', error);
            }
        }

        // Display order details
        function displayOrderDetails(order) {
            const itemsContainer = document.getElementById('order-items');
            const subtotalEl = document.getElementById('subtotal');
            const shippingEl = document.getElementById('shipping');
            const totalEl = document.getElementById('total');

            if (order.items && order.items.length > 0) {
                itemsContainer.innerHTML = order.items.map(item => `
                    <div class="flex justify-between items-center text-sm">
                        <span class="text-gray-600">
                            <span class="font-medium">${item.ten_mon}</span>
                            <span class="text-gray-400"> x${item.so_luong}</span>
                        </span>
                        <span class="font-medium">${formatCurrency(item.thanh_tien)}</span>
                    </div>
                `).join('');
            }

            const subtotal = order.tong_tien_hang || 0;
            const shipping = order.phi_van_chuyen || 0;
            const total = order.tong_thanh_toan || 0;

            if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal);
            if (shippingEl) shippingEl.textContent = shipping === 0 ? 'Miễn phí' : formatCurrency(shipping);
            if (totalEl) totalEl.textContent = formatCurrency(total);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            // Clear cart after successful payment
            // Chỉ xóa giỏ hàng khi đã vào trang thành công
            const urlParams = new URLSearchParams(window.location.search);
            const payment = urlParams.get('payment');
            const status = urlParams.get('status');

            // Nếu thanh toán VNPay thành công, xóa giỏ hàng
            if (payment === 'vnpay' && status === 'success') {
                console.log('✅ VNPay payment successful, clearing cart...');
                if (typeof cartManager !== 'undefined') {
                    cartManager.clearCart();
                } else {
                    localStorage.removeItem('cart');
                }
            }
            // Nếu không phải VNPay (COD, bank transfer, etc.) cũng xóa giỏ hàng
            else if (!payment || payment === 'cod' || payment === 'bank' || payment === 'qr' || payment === 'card') {
                console.log('✅ Order successful, clearing cart...');
                if (typeof cartManager !== 'undefined') {
                    cartManager.clearCart();
                } else {
                    localStorage.removeItem('cart');
                }
            }

            loadOrderDetails();
        });
    </script>

   
    <script>
        // Animate success icon
        gsap.from('.animate-bounce', {
            scale: 0,
            duration: 0.5,
            ease: 'back.out(1.7)'
        });

        // Animate content
        gsap.from('.bg-white', {
            y: 50,
            opacity: 0,
            duration: 0.8,
            stagger: 0.2,
            ease: 'power3.out'
        });
    </script>
</body>

</html>