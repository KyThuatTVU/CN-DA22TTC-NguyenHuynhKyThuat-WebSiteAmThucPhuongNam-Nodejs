<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng Ký - Nhà hàng Phương Nam Vĩnh Long</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/modern-style.css">
    <style>
        #avatar-preview {
            transition: all 0.3s ease;
        }
        
        #avatar-preview:hover {
            transform: scale(1.05);
            border-color: #ea580c;
        }
        
        #avatar-preview img {
            transition: transform 0.3s ease;
        }
        
        #avatar-preview:hover img {
            transform: scale(1.1);
        }
        
        .avatar-upload-label {
            transition: all 0.3s ease;
        }
        
        .avatar-upload-label:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 via-red-50 to-yellow-50">
    <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full">
            <div class="text-center mb-8">
    <a href="index.html" class="inline-flex items-center space-x-3">
        <!-- Logo hình -->
        <img src="images/Green Simple Clean Vegan Food Logo.png" alt="Phương Nam Logo" class="w-14 h-14 rounded-full border-2 border-orange-600 shadow-md object-cover">

        <div class="text-left">
            <h1 class="font-dancing text-3xl font-bold text-gray-800">Phương Nam</h1>
            <p class="text-sm text-gray-600">Vĩnh Long</p>
        </div>
    </a>
</div>


            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h2 class="text-3xl font-bold text-center mb-2">Đăng Ký</h2>
                <p class="text-gray-600 text-center mb-8">Tạo tài khoản mới</p>

                <form id="register-form" class="space-y-4">
                    <!-- Avatar Upload -->
                    <div class="flex flex-col items-center mb-4">
                        <div class="relative">
                            <div id="avatar-preview" class="w-32 h-32 rounded-full border-4 border-orange-200 overflow-hidden bg-gray-100 flex items-center justify-center">
                                <i class="fas fa-user text-5xl text-gray-400"></i>
                            </div>
                            <label for="avatar-input" class="absolute bottom-0 right-0 bg-orange-600 text-white w-10 h-10 rounded-full flex items-center justify-center cursor-pointer hover:bg-orange-700 transition shadow-lg">
                                <i class="fas fa-camera"></i>
                            </label>
                            <input type="file" id="avatar-input" name="avatar" accept="image/*" class="hidden">
                        </div>
                        <p class="text-sm text-gray-500 mt-2">Ảnh đại diện (tùy chọn)</p>
                        <p class="text-xs text-gray-400">Tối đa 5MB</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Họ và tên <span class="text-red-500">*</span></label>
                        <input type="text" id="ten_nguoi_dung" name="ten_nguoi_dung" required 
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="Nguyễn Văn A">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Email <span class="text-red-500">*</span></label>
                        <input type="email" id="email" name="email" required 
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="email@example.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Số điện thoại</label>
                        <input type="tel" id="so_dien_thoai" name="so_dien_thoai" 
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="0123456789" pattern="[0-9]{10}">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Địa chỉ</label>
                        <input type="text" id="dia_chi" name="dia_chi" 
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="123 Đường ABC, Quận 1, TP.HCM">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Giới tính</label>
                        <select id="gioi_tinh" name="gioi_tinh" 
                                class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600">
                            <option value="khac">Khác</option>
                            <option value="nam">Nam</option>
                            <option value="nu">Nữ</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Mật khẩu <span class="text-red-500">*</span></label>
                        <input type="password" id="mat_khau" name="mat_khau" required minlength="6"
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="Tối thiểu 6 ký tự">
                    </div>

                    <div>
                        <label class="block text-sm font-medium mb-2">Xác nhận mật khẩu <span class="text-red-500">*</span></label>
                        <input type="password" id="xac_nhan_mat_khau" name="xac_nhan_mat_khau" required minlength="6"
                               class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:border-orange-600" 
                               placeholder="Nhập lại mật khẩu">
                    </div>

                    <label class="flex items-start">
                        <input type="checkbox" required class="w-4 h-4 text-orange-600 rounded mt-1">
                        <span class="ml-2 text-sm text-gray-600">
                            Tôi đồng ý với <a href="#" class="text-orange-600 hover:text-orange-700">Điều khoản dịch vụ</a> và 
                            <a href="#" class="text-orange-600 hover:text-orange-700">Chính sách bảo mật</a>
                        </span>
                    </label>

                    <!-- Submit Button -->
                    <button type="submit" 
                            style="display: block !important; visibility: visible !important; opacity: 1 !important;"
                            class="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-3 rounded-lg font-medium text-lg hover:from-orange-700 hover:to-red-700 transition shadow-lg">
                        <i class="fas fa-user-plus mr-2"></i> Đăng ký
                    </button>

                    <p class="text-center text-gray-600 mt-6">
                        Đã có tài khoản? 
                        <a href="dang-nhap.html" class="text-orange-600 hover:text-orange-700 font-medium">Đăng nhập</a>
                    </p>
                </form>
            </div>

            <div class="text-center mt-6">
                <a href="index.html" class="text-gray-600 hover:text-gray-800 transition">
                    <i class="fas fa-arrow-left mr-2"></i> Quay lại trang chủ
                </a>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script>
        let uploadedAvatarPath = null;

        // Preview avatar
        document.getElementById('avatar-input').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Validate file size
            if (file.size > 5 * 1024 * 1024) {
                showNotification('Kích thước file không được vượt quá 5MB', 'error');
                this.value = '';
                return;
            }

            // Validate file type
            if (!file.type.startsWith('image/')) {
                showNotification('Vui lòng chọn file ảnh', 'error');
                this.value = '';
                return;
            }

            // Preview image
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.getElementById('avatar-preview');
                preview.innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover" alt="Avatar">`;
            };
            reader.readAsDataURL(file);

            // Upload to server
            const formData = new FormData();
            formData.append('avatar', file);

            try {
                const response = await fetch('http://localhost:3000/api/auth/upload-avatar', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (result.success) {
                    uploadedAvatarPath = result.data.anh_dai_dien;
                    showNotification('Upload ảnh thành công!', 'success');
                } else {
                    showNotification(result.message || 'Upload ảnh thất bại', 'error');
                    uploadedAvatarPath = null;
                }
            } catch (error) {
                console.error('Lỗi upload:', error);
                showNotification('Không thể upload ảnh', 'error');
                uploadedAvatarPath = null;
            }
        });

        document.getElementById('register-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = this.querySelector('button[type="submit"]');
            const originalButtonHTML = submitButton.innerHTML;
            
            // Get form data
            const formData = {
                ten_nguoi_dung: document.getElementById('ten_nguoi_dung').value.trim(),
                email: document.getElementById('email').value.trim(),
                so_dien_thoai: document.getElementById('so_dien_thoai').value.trim() || null,
                dia_chi: document.getElementById('dia_chi').value.trim() || null,
                gioi_tinh: document.getElementById('gioi_tinh').value,
                mat_khau: document.getElementById('mat_khau').value,
                anh_dai_dien: uploadedAvatarPath
            };
            
            const xac_nhan_mat_khau = document.getElementById('xac_nhan_mat_khau').value;
            
            // Validate password match
            if (formData.mat_khau !== xac_nhan_mat_khau) {
                showNotification('Mật khẩu xác nhận không khớp', 'error');
                return;
            }
            
            // Validate password length
            if (formData.mat_khau.length < 6) {
                showNotification('Mật khẩu phải có ít nhất 6 ký tự', 'error');
                return;
            }
            
            // Set loading state
            setLoadingButton(submitButton, true);
            
            // Call send verification API
            try {
                const response = await fetch('http://localhost:3000/api/auth/send-verification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification('Mã xác thực đã được gửi đến email của bạn!', 'success');
                    setTimeout(() => {
                        window.location.href = `xac-thuc-email.html?email=${encodeURIComponent(formData.email)}`;
                    }, 1500);
                } else {
                    showNotification(result.message || 'Đăng ký thất bại', 'error');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonHTML;
                }
            } catch (error) {
                console.error('Lỗi:', error);
                showNotification('Không thể kết nối đến server', 'error');
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonHTML;
            }
        });
    </script>
    <!-- Footer Container -->
    <div id="footer-container"></div>
    <!-- Chatbot Container -->
    <div id="chatbot-container"></div>
    <script src="js/load-components.js"></script>
    
    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="js/gsap-auth.js"></script>
</body>
</html>
