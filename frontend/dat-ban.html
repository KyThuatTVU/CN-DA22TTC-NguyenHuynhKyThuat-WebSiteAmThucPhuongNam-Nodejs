<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đặt Bàn - Nhà hàng Phương Nam Vĩnh Long</title>
    <link rel="icon" type="image/png" href="images/Green Simple Clean Vegan Food Logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="css/modern-style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/loading.css">
</head>
<body class="bg-gradient-to-br from-orange-50 via-red-50 to-yellow-50">
    <!-- Navigation Container -->
    <div id="navbar-container"></div>


     <section
        class="relative w-full text-white overflow-hidden h-[250px] sm:h-[320px] md:h-[380px] lg:h-[420px] flex items-center justify-center text-center">
        <!-- Background Image -->
        <div class="absolute inset-0 opacity-80" style="background-image: url('images/Banner-Com-ngon-scaled.jpg');
              background-size: cover;
              background-position: center;">
        </div>

      

        <!-- Nội dung chữ -->
        <div class="relative z-10 px-4">
            <h1
                class="font-dancing text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-3 sm:mb-4 drop-shadow-lg text-[#4b2c16]">
                Đặt bàn
            </h1>
            <p class="text-base sm:text-lg md:text-xl lg:text-2xl font-light text-[#5b3a1e]">
                Mời quý khacgs đặt bàn trước để có chỗ ngồi tốt hơn
            </p>
        </div>
    </section>



    <!-- Booking Section -->
    <section class="py-8 sm:py-12 md:py-16">
        <div class="container mx-auto px-4">
            <div class="max-w-7xl mx-auto">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 sm:gap-8 lg:gap-12">
                    <!-- Booking Form -->
                    <div class="bg-white rounded-2xl shadow-xl p-5 sm:p-8 lg:p-10 border border-orange-100">
                        <div class="flex items-center mb-6 sm:mb-8">
                            <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center mr-3 sm:mr-4">
                                <i class="fas fa-calendar-alt text-white text-lg sm:text-xl"></i>
                            </div>
                            <h2 class="text-2xl sm:text-3xl font-bold text-gray-800">Thông tin đặt bàn</h2>
                        </div>
                        <form id="booking-form" class="space-y-3 sm:space-y-4">
                            <div>
                                <label class="block text-sm font-medium mb-2">Họ và tên *</label>
                                <input type="text" required class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-orange-600" placeholder="Nguyễn Văn A">
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Số điện thoại *</label>
                                    <input type="tel" required class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 focus:outline-none focus:border-orange-600 text-base" placeholder="0123456789">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Email</label>
                                    <input type="email" class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 focus:outline-none focus:border-orange-600 text-base" placeholder="email@example.com">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Ngày đặt *</label>
                                    <input type="date" required class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 focus:outline-none focus:border-orange-600 text-base">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Giờ đặt *</label>
                                    <input type="time" required class="w-full border rounded-lg px-3 sm:px-4 py-2.5 sm:py-3 focus:outline-none focus:border-orange-600 text-base">
                                </div>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Số lượng khách *</label>
                                <select required class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-orange-600">
                                    <option value="">Chọn số lượng khách</option>
                                    <option value="1">1 người</option>
                                    <option value="2">2 người</option>
                                    <option value="3">3 người</option>
                                    <option value="4">4 người</option>
                                    <option value="5">5 người</option>
                                    <option value="6">6 người</option>
                                    <option value="7">7-10 người</option>
                                    <option value="8">Trên 10 người</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Khu vực</label>
                                <select class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-orange-600">
                                    <option value="">Chọn khu vực (tùy chọn)</option>
                                    <option value="indoor">Khu vực trong nhà</option>
                                    <option value="outdoor">Khu vực sân vườn</option>
                                    <option value="vip">Phòng VIP</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium mb-2">Ghi chú</label>
                                <textarea rows="3" class="w-full border rounded-lg px-4 py-3 focus:outline-none focus:border-orange-600" placeholder="Yêu cầu đặc biệt, dị ứng thực phẩm..."></textarea>
                            </div>

                            <button type="submit" class="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-3 sm:py-4 rounded-lg font-medium text-base sm:text-lg hover:opacity-90 transition">
                                <i class="fas fa-calendar-check mr-2"></i> Xác nhận đặt bàn
                            </button>
                        </form>
                    </div>

                    <!-- Restaurant Info -->
                    <div class="space-y-4 sm:space-y-6 lg:space-y-8">
                        <div class="bg-white rounded-2xl shadow-xl p-5 sm:p-8 lg:p-10 border border-orange-100">
                            <div class="flex items-center mb-4 sm:mb-6">
                                <div class="w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-orange-500 to-red-500 rounded-xl flex items-center justify-center mr-3 sm:mr-4">
                                    <i class="fas fa-info-circle text-white text-lg sm:text-xl"></i>
                                </div>
                                <h3 class="text-xl sm:text-2xl font-bold text-gray-800">Thông tin nhà hàng</h3>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-start">
                                    <i class="fas fa-map-marker-alt text-orange-600 text-xl mr-3 mt-1"></i>
                                    <div>
                                        <p class="font-medium">Địa chỉ</p>
                                        <p class="text-gray-600" data-setting="dia_chi">123 Đường ABC, Phường 1, TP. Vĩnh Long</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-phone text-orange-600 text-xl mr-3 mt-1"></i>
                                    <div>
                                        <p class="font-medium">Điện thoại</p>
                                        <p class="text-gray-600" data-setting="so_dien_thoai">0123 456 789</p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-clock text-orange-600 text-xl mr-3 mt-1"></i>
                                    <div>
                                        <p class="font-medium">Giờ mở cửa</p>
                                        <p class="text-gray-600">T2-T6: <span data-setting="gio_mo_cua_t2_t6">08:00-22:00</span></p>
                                        <p class="text-gray-600">T7-CN: <span data-setting="gio_mo_cua_t7_cn">07:00-23:00</span></p>
                                    </div>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-envelope text-orange-600 text-xl mr-3 mt-1"></i>
                                    <div>
                                        <p class="font-medium">Email</p>
                                        <p class="text-gray-600" data-setting="email">info@phuongnam.vn</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-orange-50 to-red-50 rounded-2xl p-5 sm:p-8 border border-orange-200">
                            <div class="flex items-center mb-3 sm:mb-4">
                                <div class="w-8 h-8 sm:w-10 sm:h-10 bg-orange-600 rounded-lg flex items-center justify-center mr-2 sm:mr-3">
                                    <i class="fas fa-exclamation-circle text-white text-sm sm:text-base"></i>
                                </div>
                                <h4 class="font-bold text-lg sm:text-xl text-gray-800">Lưu ý khi đặt bàn</h4>
                            </div>
                            <ul class="space-y-2 sm:space-y-3 text-gray-700">
                                <li class="flex items-start bg-white rounded-lg p-2.5 sm:p-3">
                                    <i class="fas fa-check-circle text-orange-600 mr-2 sm:mr-3 mt-0.5 sm:mt-1 text-base sm:text-lg"></i>
                                    <span class="text-sm sm:text-base">Vui lòng đặt bàn trước ít nhất <strong>3 tiếng</strong></span>
                                </li>
                                <li class="flex items-start bg-white rounded-lg p-2.5 sm:p-3">
                                    <i class="fas fa-check-circle text-orange-600 mr-2 sm:mr-3 mt-0.5 sm:mt-1 text-base sm:text-lg"></i>
                                    <span class="text-sm sm:text-base">Bàn sẽ được giữ trong vòng 15 phút kể từ giờ đặt</span>
                                </li>
                                <li class="flex items-start bg-white rounded-lg p-2.5 sm:p-3">
                                    <i class="fas fa-check-circle text-orange-600 mr-2 sm:mr-3 mt-0.5 sm:mt-1 text-base sm:text-lg"></i>
                                    <span class="text-sm sm:text-base">Liên hệ với chúng tôi nếu cần hủy hoặc thay đổi</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer Container -->
    <div id="footer-container"></div>
    <!-- Chatbot Container -->
    <div id="chatbot-container"></div>
    <script src="js/loading.js"></script>
    <script src="js/main.js"></script>
    <script src="js/cart.js"></script>
    <script src="js/load-components.js"></script>
    
    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    
    <script>
        // Cấu hình thời gian đặt bàn tối thiểu (3 tiếng)
        const MIN_HOURS_ADVANCE = 3;
        
        // Lấy các input
        const dateInput = document.querySelector('input[type="date"]');
        const timeInput = document.querySelector('input[type="time"]');
        const bookingForm = document.getElementById('booking-form');
        
        // Thiết lập ngày tối thiểu là hôm nay
        function setMinDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateInput.min = `${yyyy}-${mm}-${dd}`;
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        }
        
        // Thiết lập giờ tối thiểu dựa trên ngày được chọn
        function updateMinTime() {
            const selectedDate = dateInput.value;
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            
            if (selectedDate === todayStr) {
                // Nếu chọn hôm nay, giờ tối thiểu = giờ hiện tại + 3 tiếng
                const minTime = new Date(today.getTime() + MIN_HOURS_ADVANCE * 60 * 60 * 1000);
                const hours = String(minTime.getHours()).padStart(2, '0');
                const minutes = String(minTime.getMinutes()).padStart(2, '0');
                timeInput.min = `${hours}:${minutes}`;
                
                // Nếu giờ hiện tại đã quá muộn (sau 21:00), không cho đặt hôm nay
                if (minTime.getHours() >= 23) {
                    showTimeWarning('Đã quá muộn để đặt bàn hôm nay. Vui lòng chọn ngày mai.');
                    // Tự động chuyển sang ngày mai
                    const tomorrow = new Date(today);
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    const tomorrowStr = tomorrow.toISOString().split('T')[0];
                    dateInput.value = tomorrowStr;
                    timeInput.min = '07:00';
                    timeInput.value = '10:00';
                }
            } else {
                // Nếu chọn ngày khác, giờ mở cửa bình thường
                timeInput.min = '07:00';
            }
        }
        
        // Hiển thị cảnh báo thời gian
        function showTimeWarning(message) {
            // Xóa cảnh báo cũ nếu có
            const oldWarning = document.getElementById('time-warning');
            if (oldWarning) oldWarning.remove();
            
            const warning = document.createElement('div');
            warning.id = 'time-warning';
            warning.className = 'bg-amber-50 border border-amber-300 text-amber-800 px-4 py-3 rounded-lg mb-4 flex items-start';
            warning.innerHTML = `
                <i class="fas fa-exclamation-triangle text-amber-500 mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium">Lưu ý về thời gian đặt bàn</p>
                    <p class="text-sm">${message}</p>
                </div>
            `;
            
            // Chèn cảnh báo trước form
            bookingForm.insertBefore(warning, bookingForm.firstChild);
            
            // Tự động ẩn sau 5 giây
            setTimeout(() => {
                warning.style.transition = 'opacity 0.5s';
                warning.style.opacity = '0';
                setTimeout(() => warning.remove(), 500);
            }, 5000);
        }
        
        // Validate thời gian đặt bàn
        function validateBookingTime() {
            const selectedDate = dateInput.value;
            const selectedTime = timeInput.value;
            
            if (!selectedDate || !selectedTime) return false;
            
            const bookingDateTime = new Date(`${selectedDate}T${selectedTime}`);
            const now = new Date();
            const minBookingTime = new Date(now.getTime() + MIN_HOURS_ADVANCE * 60 * 60 * 1000);
            
            if (bookingDateTime < minBookingTime) {
                const diffMs = minBookingTime - bookingDateTime;
                const diffHours = Math.ceil(diffMs / (1000 * 60 * 60));
                
                showTimeWarning(`Vui lòng đặt bàn trước ít nhất ${MIN_HOURS_ADVANCE} tiếng. Thời gian bạn chọn sớm hơn ${diffHours} tiếng so với yêu cầu.`);
                return false;
            }
            
            // Kiểm tra giờ mở cửa (7:00 - 23:00)
            const hours = bookingDateTime.getHours();
            if (hours < 7 || hours >= 23) {
                showTimeWarning('Nhà hàng mở cửa từ 7:00 đến 23:00. Vui lòng chọn giờ trong khung giờ hoạt động.');
                return false;
            }
            
            return true;
        }
        
        // Khởi tạo khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            setMinDate();
            updateMinTime();
            
            // Hiển thị thông báo về quy định thời gian
            const infoBox = document.createElement('div');
            infoBox.className = 'bg-blue-50 border border-blue-200 text-blue-800 px-4 py-3 rounded-lg mb-4 flex items-start';
            infoBox.innerHTML = `
                <i class="fas fa-info-circle text-blue-500 mr-3 mt-0.5"></i>
                <div>
                    <p class="font-medium">Quy định đặt bàn</p>
                    <p class="text-sm">Quý khách vui lòng đặt bàn trước ít nhất <strong>${MIN_HOURS_ADVANCE} tiếng</strong> để nhà hàng chuẩn bị phục vụ tốt nhất.</p>
                </div>
            `;
            bookingForm.insertBefore(infoBox, bookingForm.firstChild);
            
            // Lắng nghe sự kiện thay đổi ngày
            dateInput.addEventListener('change', updateMinTime);
            
            // Lắng nghe sự kiện thay đổi giờ
            timeInput.addEventListener('change', function() {
                validateBookingTime();
            });
            
            // Xử lý submit form
            bookingForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate thời gian
                if (!validateBookingTime()) {
                    return;
                }
                
                // Lấy dữ liệu form
                const formData = {
                    ten_nguoi_dat: bookingForm.querySelector('input[type="text"]').value,
                    so_dien_thoai: bookingForm.querySelector('input[type="tel"]').value,
                    email: bookingForm.querySelector('input[type="email"]').value || null,
                    ngay_dat: dateInput.value,
                    gio_den: timeInput.value,
                    so_luong: bookingForm.querySelector('select').value,
                    khu_vuc: bookingForm.querySelectorAll('select')[1]?.value || null,
                    ghi_chu: bookingForm.querySelector('textarea').value || null
                };
                
                try {
                    // Hiển thị loading
                    const submitBtn = bookingForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Đang xử lý...';
                    submitBtn.disabled = true;
                    
                    const response = await fetch('http://localhost:3000/api/reservations/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // Hiển thị thông báo thành công
                        showSuccessModal(formData);
                        bookingForm.reset();
                        setMinDate();
                        updateMinTime();
                    } else {
                        alert('Lỗi: ' + (result.message || 'Không thể đặt bàn'));
                    }
                    
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                } catch (error) {
                    console.error('Error:', error);
                    alert('Có lỗi xảy ra. Vui lòng thử lại sau.');
                    const submitBtn = bookingForm.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-calendar-check mr-2"></i> Xác nhận đặt bàn';
                    submitBtn.disabled = false;
                }
            });
        });
        
        // Hiển thị modal thành công
        function showSuccessModal(data) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden">
                    <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-6 text-center">
                        <div class="w-20 h-20 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check text-white text-4xl"></i>
                        </div>
                        <h3 class="text-2xl font-bold text-white">Đặt bàn thành công!</h3>
                    </div>
                    <div class="p-6">
                        <div class="space-y-3 mb-6">
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Họ tên:</span>
                                <span class="font-medium">${data.ten_nguoi_dat}</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Số điện thoại:</span>
                                <span class="font-medium">${data.so_dien_thoai}</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Ngày đặt:</span>
                                <span class="font-medium">${new Date(data.ngay_dat).toLocaleDateString('vi-VN')}</span>
                            </div>
                            <div class="flex justify-between py-2 border-b">
                                <span class="text-gray-600">Giờ đến:</span>
                                <span class="font-medium">${data.gio_den}</span>
                            </div>
                            <div class="flex justify-between py-2">
                                <span class="text-gray-600">Số khách:</span>
                                <span class="font-medium">${data.so_luong} người</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-500 text-center mb-4">
                            Nhà hàng sẽ liên hệ xác nhận trong thời gian sớm nhất.
                        </p>
                        <button onclick="this.closest('.fixed').remove()" 
                                class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white py-3 rounded-xl font-medium hover:opacity-90 transition">
                            Đóng
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }
    </script>
</body>
</html>
