<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Related Products</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-6">Debug Món ăn liên quan</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">Test API</h2>
            <button onclick="testAPI()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Load món ăn danh mục 1
            </button>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">Kết quả API</h2>
            <pre id="api-result" class="bg-gray-50 p-4 rounded overflow-auto max-h-96 text-sm"></pre>
        </div>
        
        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-xl font-bold mb-4">Preview Cards</h2>
            <div id="cards-preview" class="grid grid-cols-4 gap-4"></div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:3000/api';
        
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(price);
        }
        
        async function testAPI() {
            try {
                console.log('🔍 Loading products...');
                const response = await fetch(`${API_URL}/menu/category/1`);
                const result = await response.json();
                
                document.getElementById('api-result').textContent = JSON.stringify(result, null, 2);
                
                if (result.success) {
                    const products = result.data.slice(0, 4);
                    console.log('✅ Products:', products);
                    
                    renderCards(products);
                }
            } catch (error) {
                console.error('❌ Error:', error);
                document.getElementById('api-result').textContent = 'Error: ' + error.message;
            }
        }
        
        function renderCards(products) {
            const container = document.getElementById('cards-preview');
            
            container.innerHTML = products.map(product => `
                <div class="related-card block bg-white rounded-xl overflow-hidden shadow-sm hover:shadow-md transition-all border-2 border-gray-200">
                    <div class="relative bg-gray-50">
                        <img src="http://localhost:3000${product.anh_mon}" 
                             alt="${product.ten_mon}" 
                             class="w-full h-48 object-cover"
                             onerror="this.onerror=null; this.src='images/placeholder.svg'; this.style.border='2px solid red';">
                    </div>
                    <div class="p-4">
                        <h3 class="font-semibold text-base mb-2 text-gray-800">${product.ten_mon}</h3>
                        <div class="flex items-center justify-between">
                            <span class="text-orange-600 font-bold text-lg">${formatPrice(parseFloat(product.gia_tien))}</span>
                            <span class="text-yellow-400 text-sm flex items-center gap-1">
                                <i class="fas fa-star"></i>
                                <span class="text-gray-600 font-medium">4.5</span>
                            </span>
                        </div>
                        <div class="mt-2 text-xs text-gray-500">
                            <div>ID: ${product.ma_mon}</div>
                            <div>Ảnh: ${product.anh_mon}</div>
                            <div>Tồn: ${product.so_luong_ton}</div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Check images
            setTimeout(() => {
                const images = container.querySelectorAll('img');
                images.forEach((img, index) => {
                    console.log(`Image ${index}:`, {
                        src: img.src,
                        complete: img.complete,
                        naturalWidth: img.naturalWidth,
                        naturalHeight: img.naturalHeight
                    });
                });
            }, 1000);
        }
        
        // Auto load
        window.addEventListener('DOMContentLoaded', testAPI);
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</body>
</html>
