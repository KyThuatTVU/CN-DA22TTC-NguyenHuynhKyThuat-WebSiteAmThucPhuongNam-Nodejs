<!-- Chatbot Component - Tr√† My Assistant -->
<style>
    /* Chatbot mobile fullscreen */
    @media (max-width: 640px) {
        #chatbotPanel.mobile-open {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100% !important;
            max-width: 100% !important;
            max-height: 100% !important;
            border-radius: 0 !important;
            z-index: 99999 !important;
            opacity: 1 !important;
            transform: none !important;
            pointer-events: auto !important;
        }
        #chatbotPanel.mobile-open .chatbot-header {
            padding-top: max(16px, env(safe-area-inset-top));
        }
        #chatbotPanel.mobile-open #chatbotMessages {
            height: calc(100vh - 160px) !important;
            height: calc(100dvh - 160px) !important;
        }
        #chatbotButton {
            width: 60px !important;
            height: 60px !important;
            right: 16px !important;
            bottom: 16px !important;
        }
    }
    
    /* Chat bubble styles */
    .chat-bubble-bot {
        background: white;
        border-radius: 18px;
        border-top-left-radius: 4px;
        box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    
    /* History dropdown */
    #chatHistoryDropdown {
        display: none;
        max-height: 300px;
        overflow-y: auto;
    }
    #chatHistoryDropdown.show {
        display: block;
    }
    .history-item {
        transition: all 0.2s ease;
    }
    .history-item:hover {
        background-color: #fff7ed;
    }
    .history-item.active {
        background-color: #ffedd5;
        border-left: 3px solid #f97316;
    }
    
    /* Chatbot button animation */
    #chatbotButton {
        animation: chatbot-pulse 2s infinite;
    }
    @keyframes chatbot-pulse {
        0%, 100% { box-shadow: 0 0 0 0 rgba(234, 88, 12, 0.4); }
        50% { box-shadow: 0 0 0 12px rgba(234, 88, 12, 0); }
    }
    #chatbotButton:hover {
        animation: none;
    }
    
    /* Tr√† My Avatar Logo */
    .tramy-avatar {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #fff8f0 0%, #ffe4cc 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }
    .tramy-avatar::before {
        content: '';
        position: absolute;
        width: 60%;
        height: 60%;
        background: linear-gradient(135deg, #ea580c 0%, #f97316 100%);
        border-radius: 50%;
        top: 15%;
    }
    .tramy-avatar::after {
        content: 'üå∏';
        position: absolute;
        font-size: 14px;
        bottom: 8%;
        right: 8%;
    }
</style>

<!-- CHATBOT BUTTON - M√†u cam ·∫•m √°p v·ªõi logo Tr√† My -->
<button id="chatbotButton"
    class="fixed bottom-6 right-6 z-[9999] w-16 h-16 bg-gradient-to-br from-orange-400 via-orange-500 to-amber-600 rounded-full shadow-2xl flex items-center justify-center text-white hover:scale-110 transition-transform duration-300 border-4 border-white/30">
    <!-- Logo Tr√† My - C√¥ g√°i v·ªõi n√≥n l√° -->
    <svg viewBox="0 0 64 64" class="w-10 h-10" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- N√≥n l√° -->
        <ellipse cx="32" cy="18" rx="22" ry="8" fill="#fff5e6" stroke="#fbbf24" stroke-width="1.5"/>
        <path d="M10 18 L32 4 L54 18" fill="#fef3c7" stroke="#fbbf24" stroke-width="1.5" stroke-linejoin="round"/>
        <line x1="32" y1="4" x2="32" y2="18" stroke="#fbbf24" stroke-width="1"/>
        <!-- Khu√¥n m·∫∑t -->
        <circle cx="32" cy="36" r="14" fill="#fef3c7"/>
        <!-- T√≥c -->
        <path d="M18 32 Q18 24 26 22 Q32 20 38 22 Q46 24 46 32 Q46 28 44 26 Q40 22 32 22 Q24 22 20 26 Q18 28 18 32" fill="#1c1917"/>
        <!-- M·∫Øt -->
        <ellipse cx="27" cy="35" rx="2" ry="2.5" fill="#1c1917"/>
        <ellipse cx="37" cy="35" rx="2" ry="2.5" fill="#1c1917"/>
        <circle cx="26" cy="34" r="0.8" fill="white"/>
        <circle cx="36" cy="34" r="0.8" fill="white"/>
        <!-- M√° h·ªìng -->
        <ellipse cx="23" cy="39" rx="3" ry="2" fill="#fca5a5" opacity="0.5"/>
        <ellipse cx="41" cy="39" rx="3" ry="2" fill="#fca5a5" opacity="0.5"/>
        <!-- Mi·ªáng c∆∞·ªùi -->
        <path d="M28 42 Q32 46 36 42" stroke="#dc2626" stroke-width="1.5" fill="none" stroke-linecap="round"/>
        <!-- √Åo d√†i -->
        <path d="M22 50 Q32 48 42 50 L44 60 L20 60 Z" fill="#ea580c"/>
        <path d="M30 50 L30 60 M34 50 L34 60" stroke="#c2410c" stroke-width="0.5"/>
    </svg>
</button>

<!-- CHAT PANEL -->
<div id="chatbotPanel"
    class="fixed bottom-24 right-6 z-[9999] w-[400px] sm:w-[420px] bg-white rounded-2xl shadow-2xl overflow-hidden 
           transform opacity-0 scale-90 pointer-events-none transition-all duration-300"
    style="max-height: 600px;">
    
    <!-- Header - M√†u cam gradient ·∫•m √°p -->
    <div class="chatbot-header bg-gradient-to-r from-orange-500 via-orange-600 to-amber-600 p-4 flex items-center justify-between">
        <div class="flex items-center gap-3">
            <!-- Logo Tr√† My trong header -->
            <div class="w-11 h-11 bg-white rounded-full flex items-center justify-center shadow-md p-0.5">
                <svg viewBox="0 0 64 64" class="w-full h-full" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <!-- N√≥n l√° -->
                    <ellipse cx="32" cy="18" rx="22" ry="8" fill="#fff5e6" stroke="#fbbf24" stroke-width="1.5"/>
                    <path d="M10 18 L32 4 L54 18" fill="#fef3c7" stroke="#fbbf24" stroke-width="1.5" stroke-linejoin="round"/>
                    <line x1="32" y1="4" x2="32" y2="18" stroke="#fbbf24" stroke-width="1"/>
                    <!-- Khu√¥n m·∫∑t -->
                    <circle cx="32" cy="36" r="14" fill="#fef3c7"/>
                    <!-- T√≥c -->
                    <path d="M18 32 Q18 24 26 22 Q32 20 38 22 Q46 24 46 32 Q46 28 44 26 Q40 22 32 22 Q24 22 20 26 Q18 28 18 32" fill="#1c1917"/>
                    <!-- M·∫Øt -->
                    <ellipse cx="27" cy="35" rx="2" ry="2.5" fill="#1c1917"/>
                    <ellipse cx="37" cy="35" rx="2" ry="2.5" fill="#1c1917"/>
                    <circle cx="26" cy="34" r="0.8" fill="white"/>
                    <circle cx="36" cy="34" r="0.8" fill="white"/>
                    <!-- M√° h·ªìng -->
                    <ellipse cx="23" cy="39" rx="3" ry="2" fill="#fca5a5" opacity="0.5"/>
                    <ellipse cx="41" cy="39" rx="3" ry="2" fill="#fca5a5" opacity="0.5"/>
                    <!-- Mi·ªáng c∆∞·ªùi -->
                    <path d="M28 42 Q32 46 36 42" stroke="#dc2626" stroke-width="1.5" fill="none" stroke-linecap="round"/>
                    <!-- √Åo d√†i -->
                    <path d="M22 50 Q32 48 42 50 L44 60 L20 60 Z" fill="#ea580c"/>
                    <path d="M30 50 L30 60 M34 50 L34 60" stroke="#c2410c" stroke-width="0.5"/>
                </svg>
            </div>
            <div>
                <h3 class="text-white font-bold text-base">Tr√† My - Tr·ª£ l√Ω Ph∆∞∆°ng Nam</h3>
                <div class="flex items-center gap-1.5">
                    <span class="w-2 h-2 bg-green-300 rounded-full animate-pulse"></span>
                    <p class="text-white/90 text-xs">Tr·ª±c tuy·∫øn 24/7</p>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <!-- N√∫t xem l·ªãch s·ª≠ -->
            <button onclick="toggleChatHistory()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition" title="L·ªãch s·ª≠ chat">
                <i class="fas fa-history text-sm"></i>
            </button>
            <!-- N√∫t chat m·ªõi -->
            <button onclick="startNewChat()" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition" title="Chat m·ªõi">
                <i class="fas fa-plus text-sm"></i>
            </button>
            <button id="closeChatbot" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-white hover:bg-white/30 transition">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- History Dropdown -->
    <div id="chatHistoryDropdown" class="absolute left-0 right-0 bg-white border-b border-gray-200 shadow-lg z-20" style="top: 76px;">
        <div class="p-3 border-b border-orange-100 bg-orange-50">
            <div class="flex items-center justify-between">
                <span class="text-sm font-medium text-orange-800">üìú L·ªãch s·ª≠ tr√≤ chuy·ªán</span>
                <button onclick="toggleChatHistory()" class="text-orange-400 hover:text-orange-600">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div id="historyList" class="max-h-[250px] overflow-y-auto">
            <div class="text-center text-gray-400 text-sm py-6">
                <i class="fas fa-spinner fa-spin"></i> ƒêang t·∫£i...
            </div>
        </div>
        <!-- Login prompt -->
        <div id="historyLoginPrompt" class="hidden p-3 bg-orange-50 border-t border-orange-100 text-center">
            <p class="text-xs text-orange-700 mb-2">üîí ƒêƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠ chat</p>
            <a href="dang-nhap.html" class="inline-block px-4 py-1.5 bg-orange-500 text-white rounded-full text-xs font-medium hover:bg-orange-600">
                ƒêƒÉng nh·∫≠p
            </a>
        </div>
    </div>

    <!-- Messages Area -->
    <div id="chatbotMessages" class="p-4 space-y-3 overflow-y-auto bg-gradient-to-b from-orange-50/50 to-white" style="height: 420px;">
        <!-- Messages will be loaded dynamically -->
    </div>

    <!-- Input Area -->
    <div class="p-3 bg-white border-t border-orange-100">
        <div class="flex items-center gap-2">
            <input type="text" id="chatbotInput"
                class="flex-1 h-11 border border-gray-200 rounded-full px-4 text-sm focus:outline-none focus:border-orange-400 focus:ring-2 focus:ring-orange-100 transition"
                placeholder="Nh·∫≠p tin nh·∫Øn..."
                onkeypress="if(event.key==='Enter') chatbotSendMessage()">
            <button id="sendMessage" onclick="chatbotSendMessage()"
                class="w-11 h-11 bg-gradient-to-br from-orange-400 to-amber-500 rounded-full flex items-center justify-center text-white hover:scale-105 transition flex-shrink-0 shadow-md">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
</div>
