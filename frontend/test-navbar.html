<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navbar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>

<body class="bg-gray-100">
    <!-- Navigation Container -->
    <div id="navbar-container"></div>

    <div class="container mx-auto px-4 py-24">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow">
            <h1 class="text-2xl font-bold mb-4">Test Navbar Login Status</h1>

            <div class="space-y-4">
                <div>
                    <h3 class="font-bold mb-2">Trạng thái hiện tại:</h3>
                    <p id="status" class="text-gray-600"></p>
                </div>

                <div>
                    <h3 class="font-bold mb-2">LocalStorage:</h3>
                    <pre id="localStorage-data" class="bg-gray-100 p-4 rounded text-sm overflow-auto"></pre>
                </div>

                <div class="flex gap-2">
                    <button onclick="testLogin()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        Test Login
                    </button>
                    <button onclick="testLogout()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                        Test Logout
                    </button>
                    <button onclick="refreshNavbar()"
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        Refresh Navbar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/components.js"></script>
    <script src="js/load-components.js"></script>
    <script src="js/auth.js"></script>

    <script>
        function updateStatus() {
            const user = localStorage.getItem('user');
            const token = localStorage.getItem('token');

            if (user && token) {
                const userData = JSON.parse(user);
                document.getElementById('status').innerHTML = `
                    <span class="text-green-600 font-bold">✅ Đã đăng nhập</span><br>
                    Tên: ${userData.ten_nguoi_dung}<br>
                    Email: ${userData.email}
                `;
            } else {
                document.getElementById('status').innerHTML = `
                    <span class="text-red-600 font-bold">❌ Chưa đăng nhập</span>
                `;
            }

            document.getElementById('localStorage-data').textContent = JSON.stringify({
                user: user ? JSON.parse(user) : null,
                token: token ? token.substring(0, 20) + '...' : null
            }, null, 2);
        }

        function testLogin() {
            const testUser = {
                ma_nguoi_dung: 999,
                ten_nguoi_dung: 'Test User',
                email: 'test@example.com',
                anh_dai_dien: null
            };
            const testToken = 'test-token-123456789';

            localStorage.setItem('user', JSON.stringify(testUser));
            localStorage.setItem('token', testToken);

            updateStatus();
            refreshNavbar();
        }

        function testLogout() {
            localStorage.removeItem('user');
            localStorage.removeItem('token');

            updateStatus();
            refreshNavbar();
        }

        function refreshNavbar() {
            if (typeof window.renderUserMenu === 'function') {
                window.renderUserMenu();
                console.log('✅ renderUserMenu() called');
            } else {
                console.error('❌ renderUserMenu() not found');
            }
        }

        // Update status on load
        updateStatus();

        // Auto refresh navbar after components loaded
        setTimeout(() => {
            refreshNavbar();
        }, 500);
    </script>
</body>

</html>